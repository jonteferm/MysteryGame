class SpellManager{
	constructor(game, context){
		this.game = game;
		this.context = context;
		this.library = [];
	}
	
	initSpells(casterLevel){
		var pentagram = '[{"fill":"none","stroke":"#000000","path":"M85,177.0833282470703L85,176.0833282470703L86,175.0833282470703L86,174.0833282470703L88,171.0833282470703L93,163.0833282470703L96,157.0833282470703L98,153.0833282470703L101,148.0833282470703L103,145.0833282470703L105,141.0833282470703L105,140.0833282470703L107,137.0833282470703L110,134.0833282470703L111,131.0833282470703L114,128.0833282470703L115,125.08332824707031L116,122.08332824707031L118,121.08332824707031L119,119.08332824707031L119,117.08332824707031L120,116.08332824707031L121,114.08332824707031L121,113.08332824707031L122,112.08332824707031L123,111.08332824707031L123,110.08332824707031L124,108.08332824707031L126,106.08332824707031L127,105.08332824707031L129,101.08332824707031L132,98.08332824707031L134,94.08332824707031L136,92.08332824707031L137,89.08332824707031L139,86.08332824707031L140,85.08332824707031L141,83.08332824707031L141,81.08332824707031L141,80.08332824707031L142,80.08332824707031L143,84.08332824707031L146,89.08332824707031L148,92.08332824707031L149,96.08332824707031L151,99.08332824707031L154,104.08332824707031L156,108.08332824707031L157,111.08332824707031L160,115.08332824707031L161,116.08332824707031L162,118.08332824707031L164,121.08332824707031L165,125.08332824707031L166,127.08332824707031L167,130.0833282470703L168,132.0833282470703L169,133.0833282470703L170,136.0833282470703L172,139.0833282470703L173,142.0833282470703L173,145.0833282470703L174,148.0833282470703L176,151.0833282470703L177,155.0833282470703L177,156.0833282470703L179,158.0833282470703L180,161.0833282470703L181,164.0833282470703L182,166.0833282470703L183,170.0833282470703L184,172.0833282470703L184,173.0833282470703L184,174.0833282470703L185,175.0833282470703L185,176.0833282470703L185,177.0833282470703L186,178.0833282470703L186,179.0833282470703L187,180.0833282470703L187,181.0833282470703L186,181.0833282470703L185,181.0833282470703L184,181.0833282470703L183,180.0833282470703L180,179.0833282470703L178,176.0833282470703L174,174.0833282470703L172,171.0833282470703L168,169.0833282470703L165,166.0833282470703L162,163.0833282470703L159,161.0833282470703L155,158.0833282470703L154,156.0833282470703L151,156.0833282470703L148,154.0833282470703L143,151.0833282470703L141,149.0833282470703L137,147.0833282470703L134,145.0833282470703L131,143.0833282470703L128,142.0833282470703L125,141.0833282470703L122,139.0833282470703L119,138.0833282470703L117,137.0833282470703L113,135.0833282470703L108,133.0833282470703L106,132.0833282470703L102,130.0833282470703L94,126.08332824707031L88,123.08332824707031L85,121.08332824707031L81,120.08332824707031L80,119.08332824707031L79,119.08332824707031L79,118.08332824707031L77,118.08332824707031L76,117.08332824707031L75,117.08332824707031L73,117.08332824707031L73,116.08332824707031L72,116.08332824707031L72,115.08332824707031L74,115.08332824707031L77,115.08332824707031L80,115.08332824707031L85,114.08332824707031L88,114.08332824707031L91,114.08332824707031L95,114.08332824707031L102,114.08332824707031L108,114.08332824707031L117,114.08332824707031L128,114.08332824707031L138,114.08332824707031L148,116.08332824707031L155,116.08332824707031L162,116.08332824707031L166,116.08332824707031L170,116.08332824707031L172,116.08332824707031L174,116.08332824707031L178,116.08332824707031L181,116.08332824707031L185,116.08332824707031L194,116.08332824707031L199,116.08332824707031L204,116.08332824707031L208,116.08332824707031L210,116.08332824707031L212,116.08332824707031L213,116.08332824707031L215,116.08332824707031L216,116.08332824707031L217,116.08332824707031L219,116.08332824707031L220,116.08332824707031L222,116.08332824707031L223,116.08332824707031L221,116.08332824707031L220,116.08332824707031L218,116.08332824707031L214,118.08332824707031L211,120.08332824707031L208,122.08332824707031L203,124.08332824707031L198,127.08332824707031L193,130.0833282470703L188,133.0833282470703L182,134.0833282470703L178,138.0833282470703L173,140.0833282470703L169,143.0833282470703L166,144.0833282470703L161,146.0833282470703L159,148.0833282470703L155,150.0833282470703L149,153.0833282470703L145,155.0833282470703L142,156.0833282470703L139,157.0833282470703L135,158.0833282470703L132,160.0833282470703L130,161.0833282470703L127,161.0833282470703L126,162.0833282470703L125,163.0833282470703L124,164.0833282470703L121,165.0833282470703L118,167.0833282470703L117,167.0833282470703L116,167.0833282470703L115,168.0833282470703L115,169.0833282470703L113,170.0833282470703L112,170.0833282470703L109,170.0833282470703L108,171.0833282470703L106,172.0833282470703L105,172.0833282470703L103,173.0833282470703L100,174.0833282470703L97,175.0833282470703L96,175.0833282470703L95,176.0833282470703L93,176.0833282470703L92,177.0833282470703L90,177.0833282470703L89,178.0833282470703L87,178.0833282470703L86,178.0833282470703L84,179.0833282470703L82,180.0833282470703L81,180.0833282470703","stroke-opacity":1,"stroke-width":5,"stroke-linecap":"round","stroke-linejoin":"round","transform":[],"type":"path"}]';
		var banishingSpell = new Spell(this.game, "Banishing", pentagram, this.context.signals.banishing);
		this.library.push(banishingSpell);
	}
	
	identify(drawing){
		var bestMatch = {matchingGrade: 0, spell: null};
    	
    	this.library.forEach(function(spell, index){
    		var matchingGrade = this.matchSymbols(drawing, spell.symbol);
    		
    		if(matchingGrade > 50){
    			if(matchingGrade > bestMatch.matchingGrade){
    				bestMatch.matchingGrade = matchingGrade;
    				bestMatch.spell = spell;
    			}
    		}
    	}, this);
    	
    	return bestMatch.spell;	
	}
	
	matchSymbols(drawing, spellSymbol){
		var percentage = 0;
		console.log(drawing);
		percentage = Sketchy.shapeContextMatch(drawing, spellSymbol);
		percentage = (Math.floor(percentage * 10000)/100);
		percentage = percentage.toString().substring(0,5)
		console.log(percentage);
		
		return percentage;
	}
}